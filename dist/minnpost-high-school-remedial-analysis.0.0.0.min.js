/*! minnpost-high-school-remedial-analysis - v0.0.0 - 2014-12-17
* https://github.com/minnpost/minnpost-high-school-remedial-analysis
* Copyright (c) 2014 MinnPost; Licensed MIT */

define("text!../bower.json",[],function(){return'{\n  "name": "minnpost-high-school-remedial-analysis",\n  "version": "0.0.0",\n  "main": "index.html",\n  "homepage": "https://github.com/minnpost/minnpost-high-school-remedial-analysis",\n  "repository": {\n    "type": "git",\n    "url": "https://github.com/minnpost/minnpost-high-school-remedial-analysis"\n  },\n  "bugs": "https://github.com/minnpost/minnpost-high-school-remedial-analysis/issues",\n  "license": "MIT",\n  "author": {\n    "name": "MinnPost",\n    "email": "data@minnpost.com"\n  },\n  "dependencies": {\n    "leaflet": "~0.7.3",\n    "jquery-csv": "*",\n    "highcharts-release": "~4.0.4",\n    "ractive": "~0.5.6",\n    "ractive-events-tap": "~0.1.1",\n    "ractive-backbone": "~0.1.1",\n    "requirejs": "~2.1.15",\n    "almond": "~0.3.0",\n    "text": "~2.0.12",\n    "underscore": "~1.7.0",\n    "jquery": "~1.11.1",\n    "backbone": "~1.1.2",\n    "rgrove-lazyload": "*",\n    "minnpost-styles": "master",\n    "chroma-js": "~0.6.1"\n  },\n  "devDependencies": {\n    "qunit": "~1.15.0"\n  },\n  "dependencyMap": {\n    "requirejs": {\n      "rname": "requirejs",\n      "js": [\n        "requirejs/require"\n      ]\n    },\n    "almond": {\n      "rname": "almond",\n      "js": [\n        "almond/almond"\n      ]\n    },\n    "text": {\n      "rname": "text",\n      "js": [\n        "text/text"\n      ]\n    },\n    "jquery": {\n      "rname": "jquery",\n      "js": [\n        "jquery/dist/jquery"\n      ],\n      "returns": "$"\n    },\n    "underscore": {\n      "rname": "underscore",\n      "js": [\n        "underscore/underscore"\n      ],\n      "returns": "_"\n    },\n    "backbone": {\n      "rname": "backbone",\n      "js": [\n        "backbone/backbone"\n      ],\n      "returns": "Backbone"\n    },\n    "rgrove-lazyload": {\n      "rname": "lazyload",\n      "js": [\n        "rgrove-lazyload/lazyload"\n      ],\n      "returns": "Lazyload"\n    },\n    "ractive": {\n      "rname": "ractive",\n      "js": [\n        "ractive/ractive-legacy"\n      ],\n      "returns": "Ractive"\n    },\n    "ractive-backbone": {\n      "rname": "ractive-backbone",\n      "js": [\n        "ractive-backbone/ractive-adaptors-backbone"\n      ],\n      "returns": "RactiveBackbone"\n    },\n    "ractive-events-tap": {\n      "rname": "ractive-events-tap",\n      "js": [\n        "ractive-events-tap/ractive-events-tap"\n      ],\n      "returns": "RactiveEventsTap"\n    },\n    "leaflet": {\n      "rname": "leaflet",\n      "js": [\n        "leaflet/dist/leaflet-src"\n      ],\n      "css": [\n        "leaflet/dist/leaflet"\n      ],\n      "images": [\n        "leaflet/dist/images"\n      ],\n      "returns": "L"\n    },\n    "highcharts-release": {\n      "rname": "highcharts",\n      "js": [\n        "highcharts-release/highcharts.src"\n      ],\n      "returns": "Highcharts"\n    },\n    "highcharts-release-more": {\n      "rname": "highchartsMore",\n      "js": [\n        "highcharts-release/highcharts-more.src"\n      ],\n      "returns": "HighchartsMore"\n    },\n    "chroma-js": {\n      "rname": "chroma",\n      "js": [\n        "chroma-js/chroma"\n      ],\n      "returns": "chroma"\n    },\n    "minnpost-styles": {\n      "rname": "mpStyles",\n      "css": [\n        "//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css",\n        "minnpost-styles/dist/minnpost-styles"\n      ],\n      "sass": [\n        "minnpost-styles/styles/main"\n      ]\n    },\n    "mpConfig": {\n      "rname": "mpConfig",\n      "js": [\n        "minnpost-styles/dist/minnpost-styles.config"\n      ],\n      "returns": "mpConfig"\n    },\n    "mpFormatters": {\n      "rname": "mpFormatters",\n      "js": [\n        "minnpost-styles/dist/minnpost-styles.formatters"\n      ],\n      "returns": "mpFormatters"\n    },\n    "mpHighcharts": {\n      "rname": "mpHighcharts",\n      "js": [\n        "minnpost-styles/dist/minnpost-styles.highcharts"\n      ],\n      "returns": "mpHighcharts"\n    },\n    "mpMaps": {\n      "rname": "mpMaps",\n      "js": [\n        "minnpost-styles/dist/minnpost-styles.maps"\n      ],\n      "returns": "mpMaps"\n    }\n  },\n  "resolutions": {\n    "underscore": ">=1.5.0"\n  }\n}\n'}),define("base",["jquery","underscore","backbone","lazyload","mpFormatters","text!../bower.json"],function(a,b,c,d,e,f){var g={};return f=JSON.parse(f),g.BaseApp=function(c){this.options=b.extend(this.baseDefaults||{},this.defaults||{},c||{}),this.name=this.options.name,this.options.el&&(this.el=this.options.el,this.$el=a(this.el),this.$=function(a){return this.$el.find(a)}),this.determinePaths(),this.renderAssests(),this.on("cssLoaded",function(){this.initialize.apply(this,arguments)})},b.extend(g.BaseApp.prototype,c.Events,{bower:f,baseDefaults:{jsonpProxy:"//mp-jsonproxy.herokuapp.com/proxy?url=",availablePaths:{local:{css:[".tmp/css/main.css"],images:"images/",data:"data/"},build:{css:["dist/[[[PROJECT_NAME]]].libs.min.css","dist/[[[PROJECT_NAME]]].latest.min.css"],images:"dist/images/",data:"dist/data/"},deploy:{css:["//s3.amazonaws.com/data.minnpost/projects/[[[PROJECT_NAME]]]/[[[PROJECT_NAME]]].libs.min.css","//s3.amazonaws.com/data.minnpost/projects/[[[PROJECT_NAME]]]/[[[PROJECT_NAME]]].latest.min.css"],images:"//s3.amazonaws.com/data.minnpost/projects/[[[PROJECT_NAME]]]/images/",data:"//s3.amazonaws.com/data.minnpost/projects/[[[PROJECT_NAME]]]/data/"}}},determinePaths:function(){var a;return b.isObject(this.options.paths)&&!b.isUndefined(this.options.deployment)?this.options.paths:(this.options.deployment="deploy",-1!==window.location.host.indexOf("localhost")&&(this.options.deployment="local",a=this.parseQueryString(),b.isObject(a)&&b.isString(a.mpDeployment)&&(this.options.deployment=a.mpDeployment)),this.options.paths=this.options.availablePaths[this.options.deployment],this.options.paths)},renderAssests:function(){var a=this,c=[];b.each(this.bower.dependencyMap,function(d){d.css&&b.each(d.css,function(b){"local"===a.options.deployment?(b=b.match(/^(http|\/\/)/)?b:"bower_components/"+b+".css",c.push(a.makePath(b))):b.match(/^(http|\/\/)/)&&c.push(a.makePath(b))})}),b.each(this.options.paths.css,function(b){c.push(a.makePath(b))}),d.css(c,function(){this.trigger("cssLoaded")},null,this)},makePath:function(a){return a=a.split("[[[PROJECT_NAME]]]").join(this.name),this.options.basePath&&!a.match(/^(http|\/\/)/)&&(a=this.options.basePath+a),a},overrideBackboneAJAX:function(){c.ajax=function(){var a=arguments[0];return a.dataTypeForce!==!0?this.jsonpRequest(a):c.$.ajax.apply(c.$,[a])}},isMSIE:function(){var a=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return a?parseInt(a[2],10):!1},parseQueryString:function(){var a={},c=function(a){return decodeURIComponent(a.replace(/\+/g," "))},d=location.search.substring(1),e=d.split("&");return b.each(e,function(b){var d=b.split("=");d.length>1&&(a[c(d[0])]=c(d[1]))}),a},jsonpRequest:function(b){return b.dataType="jsonp",this.options.jsonpProxy&&-1===b.url.indexOf("callback=")&&(b.jsonpCallback="mpServerSideCachingHelper"+e.hash(b.url),b.url=this.options.jsonpProxy+encodeURIComponent(b.url)+"&callback="+b.jsonpCallback,b.cache=!0),a.ajax.apply(a,[b])},dataRequest:function(c){var d=this,e=!1,f=[];return c=b.isArray(name)?c:[c],0===this.options.paths.data.indexOf("http")&&(e=!0),b.each(c,function(b){var c=e?d.jsonpRequest(d.options.paths.data+b):a.getJSON(d.options.paths.data+b);f.push(c)}),a.when.apply(a,f)},initialize:function(){}}),g.BaseApp.extend=c.Model.extend,g}),define("text!templates/application.mustache",[],function(){return'<div class="application-container">\n  <div class="message-container"></div>\n\n  <div class="content-container">\n\n    <div class="row">\n      <div class="column-small-100 column-medium-66">\n        <div id="schools-map" class="map"></div>\n      </div>\n\n      <div class="column-small-100 column-medium-33">\n        <div class="school-details">\n          {{^selectedSchool}}\n            <div class="text-center"><em>Click or tap on school in the map or on the chart to see details about that school.</em></div>\n          {{/selectedSchool}}\n\n          {{#selectedSchool}}\n            <div class="component-label">{{ properties.name }}</div>\n            <div class="space-bottom small">\n              {{ properties.district_name }} school district\n            </div>\n\n            <div class="xlarge">{{ f.percent(properties.remMean, 0) }}</div>\n            <div class="details-label">Percent of enrollees that required development education (7-year mean)</div>\n\n            <div><em class="small"></em></div>\n            <div class="large">{{ f.percent(properties.grad_rate, 0) }}</div>\n            <div class="details-label">4-year graduation rate</div>\n\n            <div class="details-chart-container">\n              <div class="chart details-chart" decorator="schoolChart:{{ this }}"></div>\n              <div class="details-label">Percent of enrollees that required development education over time</div>\n            </div>\n\n          {{/selectedSchool}}\n        </div>\n      </div>\n    </div>\n\n    <div class="row">\n      <div class="column-small-100">\n        <div class="schools-chart chart"></div>\n      </div>\n    </div>\n\n  </div>\n\n  <div class="footnote-container">\n    <div class="footnote">\n      <p>Some code, techniques, and data on <a href="https://github.com/minnpost/minnpost-high-school-remedial-analysis" target="_blank">Github</a>.</p>\n\n        <p>Some map data © OpenStreetMap contributors; licensed under the <a href="http://www.openstreetmap.org/copyright" target="_blank">Open Data Commons Open Database License</a>.  Some map design © MapBox; licensed according to the <a href="http://mapbox.com/tos/" target="_blank">MapBox Terms of Service</a>.  Location geocoding provided by <a href="http://www.mapquest.com/" target="_blank">Mapquest</a> and is not guaranteed to be accurate.</p>\n\n    </div>\n  </div>\n</div>\n'}),define("text!templates/tooltip-chart.underscore",[],function(){return"<%= p.name %>: <strong><%= f.percent(p.remMean, 0) %></strong>\n"}),define("text!../data/schools.geo.json",[],function(){return'{"type":"FeatureCollection","crs":{"type":"name","properties":{"name":"urn:ogc:def:crs:OGC:1.3:CRS84"}},"features":[{"type":"Feature","properties":{"id":"0625-01-220","grad_rate":"0.84","rem2006":0.19,"rem2007":0.27,"rem2008":0.21,"rem2009":0.18,"rem2010":0.26,"rem2011":0.29,"rem2012":0.26,"remMean":0.24,"name":"Highland Park High","address":"1015 S. Snelling Ave., St. Paul, MN 55116","district_name":"St. Paul"},"geometry":{"type":"Point","coordinates":[-93.16804155868478,44.91011836891787]}},{"type":"Feature","properties":{"id":"0001-03-368","grad_rate":"0.53","rem2006":0.32,"rem2007":0.44,"rem2008":0.29,"rem2009":0.31,"rem2010":0.36,"rem2011":0.3,"rem2012":0.24,"remMean":0.32,"name":"Washburn High","address":"201 W. 49th St., Minneapolis, MN 55409","district_name":"Minneapolis"},"geometry":{"type":"Point","coordinates":[-93.28279057628097,44.91329014656214]}},{"type":"Feature","properties":{"id":"0001-03-364","grad_rate":"0.8","rem2006":0.14,"rem2007":0.12,"rem2008":0.14,"rem2009":0.14,"rem2010":0.1,"rem2011":0.12,"rem2012":0.1,"remMean":0.12,"name":"Southwest High","address":"3414 W. 47th St., Minneapolis, MN 55410","district_name":"Minneapolis"},"geometry":{"type":"Point","coordinates":[-93.32472701129313,44.91890839003768]}},{"type":"Feature","properties":{"id":"0625-01-215","grad_rate":"0.77","rem2006":0.37,"rem2007":0.41,"rem2008":0.36,"rem2009":0.38,"rem2010":0.42,"rem2011":0.43,"rem2012":0.37,"remMean":0.39,"name":"Harding High","address":"1540 E. 6th St., St. Paul, MN 55106","district_name":"St. Paul"},"geometry":{"type":"Point","coordinates":[-93.03541747577106,44.95941906180471]}},{"type":"Feature","properties":{"id":"0001-03-358","grad_rate":"0.44","rem2006":0.2,"rem2007":0.32,"rem2008":0.33,"rem2009":0.33,"rem2010":0.37,"rem2011":0.38,"rem2012":0.64,"remMean":0.37,"name":"North High","address":"1500 James Ave. N., Minneapolis, MN 55411","district_name":"Minneapolis"},"geometry":{"type":"Point","coordinates":[-93.3001193572437,44.9940680103081]}},{"type":"Feature","properties":{"id":"0001-03-360","grad_rate":"0.49","rem2006":0.35,"rem2007":0.41,"rem2008":0.42,"rem2009":0.27,"rem2010":0.4,"rem2011":0.42,"rem2012":0.32,"remMean":0.37,"name":"Roosevelt High","address":"4029 28th Ave. S., Minneapolis, MN 55406","district_name":"Minneapolis"},"geometry":{"type":"Point","coordinates":[-93.23048735242095,44.92961587649561]}},{"type":"Feature","properties":{"id":"0001-03-362","grad_rate":"0.75","rem2006":0.15,"rem2007":0.17,"rem2008":0.2,"rem2009":0.16,"rem2010":0.15,"rem2011":0.15,"rem2012":0.16,"remMean":0.16,"name":"South High","address":"3131 19th Ave. S., Minneapolis, MN 55407","district_name":"Minneapolis"},"geometry":{"type":"Point","coordinates":[-93.24413452799908,44.945642607781735]}},{"type":"Feature","properties":{"id":"0625-01-210","grad_rate":"0.89","rem2006":0.21,"rem2007":0.21,"rem2008":0.22,"rem2009":0.21,"rem2010":0.19,"rem2011":0.26,"rem2012":0.2,"remMean":0.21,"name":"Central High","address":"275 N. Lexington Pkwy., St. Paul, MN 55104","district_name":"St. Paul"},"geometry":{"type":"Point","coordinates":[-93.14791370799544,44.949359067941316]}},{"type":"Feature","properties":{"id":"0625-01-212","grad_rate":"0.81","rem2006":0.23,"rem2007":0.26,"rem2008":0.3,"rem2009":0.26,"rem2010":0.28,"rem2011":0.32,"rem2012":0.29,"remMean":0.28,"name":"Como Park High","address":"740 W. Rose Ave., St. Paul, MN 55117","district_name":"St. Paul"},"geometry":{"type":"Point","coordinates":[-93.13127349009197,44.97593525467396]}},{"type":"Feature","properties":{"id":"0625-01-230","grad_rate":"0.77","rem2006":0.33,"rem2007":0.32,"rem2008":0.26,"rem2009":0.33,"rem2010":0.34,"rem2011":0.42,"rem2012":0.38,"remMean":0.34,"name":"Johnson High","address":"1349 Arcade St., St. Paul, MN 55106","district_name":"St. Paul"},"geometry":{"type":"Point","coordinates":[-93.06783019762182,44.98143674257659]}},{"type":"Feature","properties":{"id":"0001-03-352","grad_rate":"0.52","rem2006":0.34,"rem2007":0.36,"rem2008":0.4,"rem2009":0.33,"rem2010":0.38,"rem2011":0.43,"rem2012":0.45,"remMean":0.38,"name":"Edison High","address":"700 22nd Ave. NE, Minneapolis, MN 55418","district_name":"Minneapolis"},"geometry":{"type":"Point","coordinates":[-93.25176357693164,45.00944098070713]}},{"type":"Feature","properties":{"id":"0001-03-354","grad_rate":"0.68","rem2006":0.31,"rem2007":0.37,"rem2008":0.27,"rem2009":0.3,"rem2010":0.33,"rem2011":0.29,"rem2012":0.33,"remMean":0.31,"name":"Patrick Henry High","address":"4320 Newton Ave. N., Minneapolis, MN 55412","district_name":"Minneapolis"},"geometry":{"type":"Point","coordinates":[-93.30533887817293,45.034034008324795]}}]}'}),require(["jquery","underscore","backbone","lazyload","ractive","ractive-backbone","ractive-events-tap","leaflet","highcharts","highchartsMore","chroma","mpConfig","mpFormatters","mpHighcharts","mpMaps","base","text!templates/application.mustache","text!templates/tooltip-chart.underscore","text!../data/schools.geo.json"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){r=b.template(r),s=JSON.parse(s);var t=p.BaseApp.extend({defaults:{name:"minnpost-high-school-remedial-analysis",el:".minnpost-high-school-remedial-analysis-container"},initialize:function(){var a=this;this.schools=s,this.schools.features=b.sortBy(this.schools.features,function(a){return a.properties.remMean}),this.colorScale=k.scale([l["colors-data"].green1,l["colors-data"].blue1]).mode("hsl").domain(b.map(this.schools.features,function(a){return a.properties.remMean}),5),this.mainView=new e({el:this.$el,template:q,data:{f:m},partials:{},decorators:{schoolChart:this.schoolChartDecorator}}),this.drawCharts(),this.drawMaps(),this.mainView.observe("selectedSchoolID",function(c){var d=b.find(a.schools.features,function(a){return!!c&&a.properties.id===c});d&&(this.set("selectedSchool",d),a.highlight(d))})},drawCharts:function(){var c=this;this.chartData=[{name:"Schools",color:l["colors-data"].blue1,data:b.map(this.schools.features,function(a){return{id:a.properties.id,name:a.properties.name,y:100*a.properties.remMean,remMean:a.properties.remMean,color:c.colorScale(a.properties.remMean).hex()}})}],this.schoolsChart=n.makeChart(this.$(".schools-chart"),a.extend(!0,{},n.columnOptions,{series:this.chartData,legend:{enabled:!1},yAxis:{opposite:!0,title:{text:"% of enrollees"}},xAxis:{type:"category",labels:{rotation:-45}},tooltip:{formatter:function(){return r({p:this.point,f:m})}},plotOptions:{series:{cursor:"pointer",states:{hover:{enabled:!1}},borderWidth:3,point:{events:{click:function(){c.mainView.set("selectedSchoolID",this.id)}}}}}}))},drawMaps:function(){var a=this;this.map=o.makeLeafletMap("schools-map"),this.tooltipControl=new o.TooltipControl,this.map.setZoom(9),this.map.addControl(this.tooltipControl),this.schoolMapLayer=h.geoJson(this.schools,{pointToLayer:function(a,b){return h.circleMarker(b,{radius:8})},style:function(c){var d=a.colorScale(c.properties.remMean).hex(),e=b.extend(o.mapStyle,{fillColor:d,fillOpacity:.8,stroke:!0,color:d,weight:5,opacity:.2});return e},onEachFeature:function(c,d){d.on("mouseover",function(){a.tooltipControl.update(c.properties.name)}),d.on("mouseout",function(){a.tooltipControl.hide()}),d.on("click",function(){a.mainView.set("selectedSchoolID",c.properties.id)}),d.originalOptions=b.clone(d.options)}}).addTo(this.map),this.map.fitBounds(this.schoolMapLayer.getBounds(),{reset:!0})},highlight:function(a){var c=a.properties;this.schoolMapLayer.eachLayer(function(a){a.setStyle(a.feature.properties.id===c.id?b.extend(b.clone(a.originalOptions),{opacity:.75,color:"#222222",weight:3}):b.clone(a.originalOptions))}),b.each(this.schoolsChart.series[0].data,function(a){a.id===c.id?a.update({borderColor:"#222222",borderWidth:3},!0,!1):a.update({borderColor:null,borderWidth:null},!0,!1)})},schoolChartDecorator:function(c,d){var e,f,g=d.properties;return!b.isObject(e)&&b.isObject(d)&&(f=[{name:"Remedial score over time",color:l["colors-data"].purple,data:[[2006,100*g.rem2006],[2007,100*g.rem2007],[2008,100*g.rem2008],[2009,100*g.rem2009],[2010,100*g.rem2010],[2011,100*g.rem2011],[2012,100*g.rem2012]]}],e=n.makeChart(a(c),a.extend(!0,{},n.lineOptions,{series:f,legend:!1,yAxis:{title:{enabled:!1}},tooltip:{formatter:function(){return this.x+": "+m.number(this.y,0)+"%"}}}))),{teardown:function(){b.isObject(e)&&e.destroy()}}}});return new t({})}),define("app",function(){});